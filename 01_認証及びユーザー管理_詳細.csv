大分類,中分類,項目,詳細内容
━━━ UI基本設計書 ━━━,,,
基本情報,機能名,認証及びユーザー管理,
,対象画面,会員登録 ・ ログイン ・ マイページ ・ プロフィール編集 ・ パスワード変更 ・ プロフィール閲覧 ・ アカウント停止ページ,
,技術スタック,Next.js 15 ・ TypeScript ・ NextAuth v4 ・ Prisma ・ PostgreSQL,
,作成日,2025-10-28,
━━━ 1. 画面概要 ━━━,,,
会員登録ページ,機能,新規会員登録,メールアドレスとパスワードによる登録 ・ Google OAuthにも対応
,ファイル,src/app/register/page.tsx,
ログインページ,機能,ログイン認証,メール認証とGoogle OAuth ・ 停止中ユーザーのログインブロック機能付き
,ファイル,src/app/login/page.tsx,
マイページ,機能,ユーザーダッシュボード,ログインユーザー専用 ・ 停止状態チェック含む ・ プロフィール編集・会員退会へのアクセス
,ファイル,src/app/MyPage/page.tsx,
プロフィール編集ページ,機能,プロフィール更新,ニックネーム ・ プロフィール画像 ・ 自己紹介の編集 ・ 画像アップロード対応
,ファイル,src/app/profile-edit/page.tsx,
パスワード変更ページ,機能,パスワード更新,既存パスワード確認後に新しいパスワードを設定 ・ OAuth専用ユーザーは非表示
,ファイル,src/app/change-password/page.tsx,
プロフィール閲覧ページ,機能,他ユーザー閲覧,他ユーザーのプロフィールを閲覧 ・ フォロー・ブロック機能付き
,ファイル,src/app/profile/[userId]/page.tsx,
アカウント停止ページ,機能,停止専用画面,停止中のユーザー専用 ・ 停止理由と期限を表示 ・ ログアウトのみ可能
,ファイル,src/app/suspended/page.tsx,
━━━ 2. 前提・制約 ━━━,,,
データ取得,方式,サーバーサイド取得,各画面でgetServerSession()を使用してセッション情報を取得
認証チェック,制約,ログイン必須,未ログインユーザーはログインページへリダイレクト
停止ユーザー,制約,ログイン拒否,停止中ユーザーはログイン試行時にブロックし停止ページへリダイレクト
OAuth対応,制約,パスワード不要,Googleアカウントでのログインはパスワード変更不可
画像制約,ファイル制限,最大5MB,対応形式: jpg / jpeg / png / gif / webp
━━━ 3. 関連URL・遷移 ━━━,,,
URL一覧,/register,会員登録ページ,
,/login,ログインページ,
,/MyPage,マイページ（ログイン後のダッシュボード）,
,/profile-edit,プロフィール編集ページ,
,/change-password,パスワード変更ページ,
,/profile/[userId],ユーザープロフィール閲覧ページ,
,/suspended,アカウント停止専用ページ,
遷移フロー,基本フロー,会員登録 → ログイン → マイページ → プロフィール編集 or パスワード変更 or 会員退会,
━━━ 4. 役割・権限 ━━━,,,
一般ユーザー,アクセス権限,全ての認証機能,全ての認証機能にアクセス可能 ・ 自分のプロフィールのみ編集可能
停止ユーザー,アクセス制限,ログイン不可,既存セッションも無効化 ・ マイページアクセス時に停止ページへリダイレクト
削除済みユーザー,アクセス制限,ログイン不可,セッション無効化 ・ 再登録は同じメールアドレスで可能
━━━ 5. 主要機能一覧 ━━━,,,
会員登録機能,入力項目,メールアドレス ・ パスワード ・ ニックネーム,バリデーション付き新規登録
Google OAuth登録,SNSログイン,Googleアカウント連携,ワンクリックSNSログイン ・ 自動会員登録
ログイン機能,認証方式,メール/パスワード or Google OAuth,エラーハンドリング付き
停止チェック,セキュリティ,ログイン時の停止状態確認,停止中の場合はモーダル（一般）または停止ページ（OAuth）で拒否
プロフィール編集,編集項目,ニックネーム ・ 画像 ・ 自己紹介,画像はアップロード後にプレビュー表示
パスワード変更,変更要件,既存パスワード確認 + 新しいパスワード設定,8文字以上 ・ OAuth専用ユーザーは非表示
セーフティフィルター,コンテンツ設定,不適切コンテンツのフィルタリング,オン/オフ切り替え
会員退会機能,削除プロセス,2段階確認によるアカウント削除,作成したキャラクターは作成者を匿名化して保持 ・ 個人データは完全削除
セッション保護,リアルタイムチェック,マイページアクセス時に停止状態を再確認,停止中なら停止ページへリダイレクト
━━━ 6. 画面構成（UIブロック） ━━━,,,
ヘッダー,共通要素,ロゴ ・ ナビゲーションリンク,ホーム / キャラクター / チャット / マイページ / ランキング（全ページ共通）
ボトムナビ,モバイル専用,下部ナビゲーション,5つの主要ページへのクイックアクセス（全ページ共通）
会員登録フォーム,入力欄,メールアドレス ・ パスワード ・ ニックネーム + Google OAuthボタン ・ 送信ボタン,/register
ログインフォーム,入力欄,メールアドレス ・ パスワード + Google OAuthボタン ・ ログインボタン ・ エラーメッセージ表示エリア,/login
停止モーダル,表示内容,停止理由 ・ 停止期限表示,ログイン拒否メッセージ（/login 一般ログイン時）
停止ページ,専用画面,停止理由 ・ 停止期限の大きな表示 + サポート連絡先案内 ・ ログアウトボタンのみ,/suspended（OAuth時）
マイページダッシュボード,表示要素,プロフィール情報 ・ 作成キャラクター一覧 ・ ポイント表示 ・ 各種設定リンク,/MyPage
プロフィール編集フォーム,入力欄,ニックネーム ・ 画像アップロード ・ 自己紹介テキストエリア + プレビュー表示 ・ 保存ボタン,/profile-edit
パスワード変更フォーム,入力欄,既存パスワード ・ 新しいパスワード ・ 確認用パスワード + 変更ボタン,/change-password
プロフィール閲覧,表示要素,ユーザー情報 ・ 作成キャラクター一覧 ・ フォロー/ブロックボタン（本人の場合は編集ボタン）,/profile/[userId]
会員退会モーダル,確認ダイアログ,確認メッセージ（2段階） ・ キャラクター保持に関する説明 ・ 最終確認ボタン,/MyPage（退会ボタン押下時）
━━━ 7. 画面項目定義 ━━━,,,
【会員登録】メールアドレス,型: string,必須 ・ メール形式チェック ・ 既存ユーザー重複チェック,一意制約
【会員登録】パスワード,型: string,必須 ・ 8文字以上 ・ 英数字推奨,bcryptでハッシュ化
【会員登録】ニックネーム,型: string,必須 ・ 1〜50文字,
【ログイン】メールアドレス,型: string,必須 ・ メール形式チェック,
【ログイン】パスワード,型: string,必須 ・ 入力必須,bcrypt検証
【プロフィール編集】ニックネーム,型: string,必須 ・ 1〜50文字,
【プロフィール編集】プロフィール画像,型: file,任意 ・ jpg/jpeg/png/gif/webp ・ 最大5MB,アップロード後にURL保存
【プロフィール編集】自己紹介,型: string,任意 ・ 最大500文字,テキストエリア
【パスワード変更】現在のパスワード,型: string,必須 ・ 既存パスワード一致確認,
【パスワード変更】新しいパスワード,型: string,必須 ・ 8文字以上,
【パスワード変更】パスワード確認,型: string,必須 ・ 新しいパスワードと一致,
━━━ 8. フィルタ仕様 ━━━,,,
停止ユーザーフィルター,チェック対象,users.suspendedUntil,ログイン時に確認 ・ 現在時刻より未来なら停止中と判定（一般・OAuth共通）
セーフティフィルター,適用範囲,キャラクター表示 ・ チャット応答,ユーザーごとにオン/オフ設定可能（users.safetyFilterEnabled）
━━━ 9. API I/F 仕様 ━━━,,,
POST /api/register,パラメータ,{ email・password・nickname },レスポンス: { success・userId } ・ 新規会員登録API
POST・GET /api/auth/[...nextauth],パラメータ,NextAuth標準パラメータ,レスポンス: { session・user } ・ NextAuth認証ハンドラー（ログイン・OAuth）
GET /api/users/profile,パラメータ,クエリなし,レスポンス: { user: { id・nickname・email・image・bio } } ・ プロフィール情報取得API
PUT /api/users/profile,パラメータ,{ nickname・image・bio },レスポンス: { success・message } ・ プロフィール更新API
POST /api/users/change-password,パラメータ,{ currentPassword・newPassword },レスポンス: { success・message } ・ パスワード変更API
PUT /api/users/safety-filter,パラメータ,{ enabled: boolean },レスポンス: { success } ・ セーフティフィルター設定API
DELETE /api/users/account,パラメータ,クエリなし,レスポンス: { success・message } ・ アカウント削除API（会員退会）
GET /api/profile/[userId],パラメータ,パスなし（userIdはURLパラメータ）,レスポンス: { user: { id・nickname・image・bio・createdAt } } ・ 特定ユーザープロフィール取得API
━━━ 10. エラー・通知文言 ━━━,,,
会員登録エラー,表示タイミング: 重複メール登録時,このメールアドレスは既に登録されています。,
ログインエラー,表示タイミング: 認証失敗時,メールアドレスまたはパスワードが正しくありません。,
停止エラー,表示タイミング: 停止中ユーザーのログイン時,あなたのアカウントは停止されています。 理由: {reason} ・ 期限: {date},
削除済みエラー,表示タイミング: 削除済みアカウントのログイン時,このアカウントは削除されました。,
パスワード変更エラー,表示タイミング: パスワード不一致時,現在のパスワードが正しくありません。,
画像アップロードエラー,表示タイミング: 画像サイズオーバー時,画像サイズは5MB以下にしてください。,
成功メッセージ,表示タイミング: プロフィール更新成功時,プロフィールを更新しました。,
成功メッセージ,表示タイミング: パスワード変更成功時,パスワードを変更しました。,
退会完了メッセージ,表示タイミング: 会員退会完了時,ご利用ありがとうございました。またのご利用をお待ちしております。,
━━━ 11. モーダル仕様 ━━━,,,
停止通知モーダル,トリガー: 停止中ユーザーのログイン時,内容: 停止理由と期限を表示,ボタン: 閉じるボタンのみ
会員退会確認モーダル（1段階目）,トリガー: マイページの退会ボタン押下時,内容: アカウント削除の影響を説明 ・ キャラクター保持の説明,ボタン: キャンセル ・ 次へ
会員退会確認モーダル（2段階目）,トリガー: 1段階目で「次へ」押下時,内容: 最終確認メッセージ ・ 「本当に削除しますか？」,ボタン: キャンセル ・ 削除する
パスワード変更確認モーダル,トリガー: パスワード変更成功時,内容: 変更完了メッセージ,ボタン: OK
━━━ 12. 認証・ガード ━━━,,,
認証チェック,実装方式,全ページでgetServerSession()を使用,未ログインなら/loginへリダイレクト
停止チェック,実装方式,マイページアクセス時にusers.suspendedUntilを確認,停止中なら/suspendedへリダイレクト
OAuth専用ユーザー,判定方式,hasPasswordフラグで判定,パスワード変更メニューを非表示に
━━━ 13. 非機能要件 ━━━,,,
パフォーマンス,最適化手法,セッション情報はRedisでキャッシュ ・ プロフィール画像はCDN配信,
セキュリティ,暗号化方式,パスワードはbcryptでハッシュ化（saltRounds: 10） ・ CSRF保護有効,
スケーラビリティ,拡張性,NextAuth標準のセッション管理 ・ 水平スケール可能,
可用性,フォールバック,データベース接続エラー時はフォールバック画面表示,
━━━ 14. テスト観点 ━━━,,,
会員登録: 正常系,テストケース,有効なメール・パスワード・ニックネームで登録成功,
会員登録: 異常系,テストケース,重複メールで登録失敗 ・ バリデーションエラー表示,
ログイン: 正常系,テストケース,正しいメール・パスワードでログイン成功,
ログイン: 異常系,テストケース,間違ったパスワードでエラー表示,
停止ユーザー: ログイン拒否,テストケース,停止中ユーザーのログイン拒否 ・ 停止情報表示,
停止ユーザー: セッション無効化,テストケース,停止中ユーザーの既存セッション無効化 ・ マイページアクセス時リダイレクト,
OAuth: 正常系,テストケース,Google OAuthで新規登録とログイン成功,
OAuth: メニュー制御,テストケース,OAuth専用ユーザーのパスワード変更メニュー非表示,
プロフィール編集: 正常系,テストケース,ニックネーム・画像・自己紹介更新成功,
プロフィール編集: 異常系,テストケース,画像サイズオーバーでエラー表示,
パスワード変更: 正常系,テストケース,正しい現在パスワードで変更成功,
パスワード変更: 異常系,テストケース,間違った現在パスワードでエラー表示,
会員退会: 正常系,テストケース,2段階確認を経て削除成功 ・ キャラクター匿名化確認,
会員退会: ログイン制限,テストケース,削除後のログイン不可確認,
━━━ 15. 今後の拡張余地 ━━━,,,
2段階認証,提案内容,SMS・認証アプリによる2FAの実装,
ソーシャルログイン拡張,提案内容,Twitter / Facebook / Apple IDログインの追加,
メール認証,提案内容,会員登録時のメールアドレス確認機能,
パスワードリセット,提案内容,メールによるパスワード再設定機能,
プロフィール項目拡張,提案内容,誕生日・性別・地域などの追加項目,
アクティビティログ,提案内容,ログイン履歴・IPアドレス記録,

セクション,項目,内容,補足
UI基本設計書,機能名,ポイントシステム,
,対象画面,ポイント管理ページ,
,技術スタック,"Next.js 15, TypeScript, Prisma, PostgreSQL",
,作成日,2025-10-28,

1. 画面概要,ポイント管理ページ,ユーザーのポイント残高・履歴を表示。無料ポイントと有料ポイントを分離管理。出席チェック機能付き。,src/app/points/page.tsx

2. 前提/制約,データ取得,ポイント情報はサーバーサイドで取得。リアルタイム更新はクライアントサイドで実装。,
,ポイント種類,無料ポイントと有料ポイントを分離管理。消費時は無料ポイント優先。,
,出席チェック,1日1回の出席チェックで無料ポイントを獲得。連続出席でボーナスポイント。,
,ポイント消費,チャットメッセージ送信時にポイントを消費。1メッセージにつき10ポイント。,
,ポイント履歴,ポイントの獲得・消費履歴を記録。日時・種類・変動量を表示。,

3. 関連URL・遷移,/points,ポイント管理ページ,
,遷移フロー,"マイページ → ポイント管理 → 出席チェック or ポイント購入",

4. 役割・権限,一般ユーザー,ポイント閲覧・出席チェック・ポイント購入（将来実装）が可能。,
,管理者,ユーザーのポイントを手動で増減可能。,

5. 主要機能一覧,ポイント残高表示,無料ポイント・有料ポイントの残高を表示。合計ポイントも表示。,
,出席チェック,1日1回のクリックで無料ポイントを獲得。連続出席でボーナスポイント（7日連続で100ポイント、30日連続で500ポイント）。,
,ポイント履歴閲覧,ポイントの獲得・消費履歴を一覧表示。日時・種類・変動量・残高を表示。,
,ポイント消費,チャットメッセージ送信時に自動的にポイントを消費。無料ポイント優先。,
,ポイント購入（将来実装）,有料ポイントを購入する機能。決済システム連携。,

6. 画面構成,ポイント残高カード,無料ポイント・有料ポイント・合計ポイントを大きく表示。各ポイントのアイコン付き。,
,出席チェックボタン,1日1回クリック可能。出席済みの場合は「出席済み」表示。連続出席日数表示。,
,ポイント履歴テーブル,日時・種類（獲得/消費）・変動量・残高を表示。ページネーション対応。,
,ポイント購入ボタン,有料ポイント購入ページへのリンク（将来実装）。,

7. 画面項目定義,項目名（ポイント）,型,必須,バリデーション,備考
,無料ポイント,number,必須,0以上,
,有料ポイント,number,必須,0以上,
,合計ポイント,number,必須,0以上,無料ポイント + 有料ポイント
,項目名（ポイント履歴）,型,必須,バリデーション,備考
,日時,datetime,必須,ISO 8601形式,
,種類,string,必須,獲得/消費,
,変動量,number,必須,正数（獲得）または負数（消費）,
,残高,number,必須,0以上,取引後の残高
,説明,string,任意,最大200文字,出席チェック・チャット使用など

8. フィルタ仕様,ポイント消費優先順位,消費時は無料ポイント優先。無料ポイントが不足する場合は有料ポイントを消費。,
,出席チェック制限,1日1回のみ。前回の出席チェックから24時間経過後に再度可能。,

9. API I/F 仕様,エンドポイント,メソッド,パラメータ,レスポンス,説明
,/api/points,GET,クエリなし,"{ freePoints, paidPoints, totalPoints, checkInStreak }",ポイント情報取得API
,/api/points,POST,"{ type: 'check-in' }","{ success, points, streak }",出席チェックAPI
,/api/users/points,GET,クエリなし,"{ points: { free, paid, total }, history: [] }",ユーザーポイント情報取得API（履歴含む）

10. エラー・通知文言,エラータイプ,文言,表示タイミング
,出席チェックエラー,今日は既に出席チェックを行いました。明日またお越しください。,24時間以内の再出席チェック時
,ポイント不足エラー,ポイントが不足しています。ポイントをチャージしてください。,ポイント不足時
,成功メッセージ,出席チェック完了！{points}ポイントを獲得しました。,出席チェック成功時
,ボーナスメッセージ,{days}日連続出席達成！ボーナス{points}ポイントを獲得しました。,連続出席ボーナス獲得時

11. モーダル仕様,モーダル名,トリガー,内容,ボタン
,出席チェック完了,出席チェック成功時,獲得ポイント数と連続出席日数を表示。ボーナスポイント獲得時は祝福メッセージ。,閉じる
,ポイント不足警告,ポイント不足時,ポイント不足メッセージ。ポイント購入ページへのリンク（将来実装）。,閉じる

12. 認証/ガード,認証チェック,ポイント機能はログイン必須。未ログインなら/loginへリダイレクト。,

13. 非機能要件,パフォーマンス,ポイント履歴はページネーション対応（1ページ20件）。,
,セキュリティ,ポイント情報は他ユーザーに非公開。APIアクセス制限。,
,スケーラビリティ,ポイント消費はトランザクション処理。同時実行制御。,
,可用性,ポイント消費失敗時はロールバック。エラー時は適切なエラーメッセージ表示。,

14. テスト観点,項目,テストケース
,出席チェック,正常系：1日1回の出席チェックで無料ポイント獲得成功
,出席チェック,異常系：24時間以内の再出席チェックでエラー表示
,連続出席ボーナス,7日連続出席で100ポイントボーナス獲得確認
,連続出席ボーナス,30日連続出席で500ポイントボーナス獲得確認
,ポイント消費,チャットメッセージ送信時に無料ポイント優先消費確認
,ポイント消費,無料ポイント不足時に有料ポイント消費確認
,ポイント不足,ポイント不足時にエラーメッセージ表示確認
,ポイント履歴,ポイント獲得・消費履歴が正確に記録されることを確認
,ポイント残高,ポイント残高がリアルタイムで更新されることを確認

15. 今後の拡張余地,項目,提案内容
,決済システム,有料ポイント購入機能（クレジットカード・PayPalなど）
,ポイントギフト,他ユーザーにポイントを贈る機能
,ポイント交換,ポイントを他のサービスのポイントに交換
,ミッション,特定のタスクを完了してポイントを獲得
,ポイント有効期限,無料ポイントに有効期限を設定（例：90日）
,ポイントランキング,ポイント獲得数でユーザーをランキング


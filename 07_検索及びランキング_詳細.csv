セクション,項目,内容,補足
UI基本設計書,機能名,検索及びランキング,
,対象画面,"検索ページ、ランキングページ、メインページ",
,技術スタック,"Next.js 15, TypeScript, Prisma, PostgreSQL, pgvector",
,作成日,2025-10-28,

1. 画面概要,検索ページ,キーワードでキャラクター・ユーザーを検索。カテゴリー・ハッシュタグでフィルタリング可能。,src/app/search/page.tsx
,ランキングページ,人気キャラクター・新規キャラクターをランキング形式で表示。カテゴリー別ランキングも表示。,src/app/ranking/page.tsx
,メインページ,トレンドキャラクター・人気キャラクター・新着キャラクターを表示。ユーザーにパーソナライズされた推薦。,src/app/page.tsx

2. 前提/制約,データ取得,検索結果はサーバーサイドでフィルタリング済みデータを取得。ページネーション対応。,
,検索対象,キャラクター名・説明・ハッシュタグを検索対象とする。部分一致検索。,
,ベクトル検索,キャラクター説明のベクトル埋め込みを使用した意味検索（pgvector）。,
,ランキング更新,ランキングは1時間ごとに更新。キャッシュを使用して高速化。,
,人気度計算,お気に入り数・チャット数・コメント数を重み付けして人気度を計算。,

3. 関連URL・遷移,/search,検索ページ,
,/ranking,ランキングページ,
,/,メインページ（トレンドキャラクター表示）,
,遷移フロー,"メインページ → 検索/ランキング → キャラクター詳細 → チャット開始",

4. 役割・権限,全ユーザー,検索・ランキング機能は未ログインでも閲覧可能。,
,ログインユーザー,パーソナライズされた推薦を表示。,

5. 主要機能一覧,キーワード検索,キャラクター名・説明・ハッシュタグで検索。部分一致検索。,
,意味検索,キャラクター説明のベクトル埋め込みを使用した意味検索。関連キャラクターを表示。,
,カテゴリーフィルター,カテゴリー別にキャラクターをフィルタリング。複数カテゴリー選択可能。,
,ハッシュタグ検索,ハッシュタグで検索。複数タグでフィルタリング可能。,
,人気ランキング,お気に入り数・チャット数・コメント数で人気度を計算してランキング表示。,
,新規ランキング,作成日時順に新しいキャラクターをランキング表示。,
,カテゴリー別ランキング,各カテゴリーの人気キャラクターをランキング表示。,
,トレンド表示,24時間以内にお気に入り・チャットが急増したキャラクターをトレンドとして表示。,
,パーソナライズ推薦,ユーザーの過去のチャット・お気に入りを分析して推薦キャラクターを表示。,
,並び替え,人気順・新しい順・古い順・お気に入り数順で並び替え可能。,

6. 画面構成,検索バー,キーワード入力欄・検索ボタン。リアルタイム検索候補表示（オートコンプリート）。,
,フィルターサイドバー,カテゴリー・ハッシュタグ・並び替えオプションを表示。チェックボックスで複数選択。,
,検索結果グリッド,キャラクターカードをグリッドレイアウトで表示。ページネーション付き。,
,ランキングリスト,順位・キャラクター情報・人気度を表示。1位〜100位まで。,
,トレンドセクション,トレンドキャラクターを横スクロールで表示。「トレンド」バッジ付き。,
,カテゴリータブ,カテゴリー別ランキングをタブで切り替え。各カテゴリーのトップ10を表示。,
,メインページヒーロー,注目のキャラクターを大きく表示。背景画像・説明・チャット開始ボタン。,
,推薦セクション,パーソナライズされた推薦キャラクターを表示。「あなたへのおすすめ」タイトル付き。,

7. 画面項目定義,項目名（検索）,型,必須,バリデーション,備考
,検索キーワード,string,任意,最大100文字,
,カテゴリー,string[],任意,事前定義されたカテゴリーから選択,
,ハッシュタグ,string[],任意,各タグ20文字以内,
,並び替え,string,任意,"popularity/newest/oldest/favorites",デフォルト: popularity
,ページ,number,任意,1以上,デフォルト: 1
,項目名（ランキング）,型,必須,バリデーション,備考
,ランキング種類,string,必須,"popular/new/category",
,カテゴリー,string,任意,カテゴリー別ランキングの場合のみ,
,期間,string,任意,"daily/weekly/monthly/all-time",デフォルト: all-time

8. フィルタ仕様,検索フィルター,キーワード・カテゴリー・ハッシュタグを組み合わせてフィルタリング。AND条件。,
,人気度計算式,"(お気に入り数 × 3) + (チャット数 × 2) + (コメント数 × 1)",
,トレンド判定,24時間以内のお気に入り・チャット増加率が上位10%のキャラクターをトレンドと判定。,

9. API I/F 仕様,エンドポイント,メソッド,パラメータ,レスポンス,説明
,/api/search,GET,"{ q, category?, tags?, sort?, page, limit }","{ characters: [], total, page, totalPages }",キャラクター検索API
,/api/ranking,GET,"{ type: 'popular'|'new'|'category', category?, period?, limit }","{ characters: [], rankings: [] }",ランキング取得API
,/api/main-page,GET,クエリなし,"{ trending: [], popular: [], newest: [], recommended: [] }",メインページデータ取得API

10. エラー・通知文言,エラータイプ,文言,表示タイミング
,検索結果なし,検索結果が見つかりませんでした。別のキーワードで検索してください。,検索結果0件時
,エラー,検索に失敗しました。もう一度お試しください。,検索API失敗時

11. モーダル仕様,モーダル名,トリガー,内容,ボタン
,フィルター詳細,フィルターボタン押下時（モバイル）,カテゴリー・ハッシュタグ・並び替えオプションを表示。,適用・リセット

12. 認証/ガード,認証不要,検索・ランキング機能は未ログインでも閲覧可能。,
,パーソナライズ,ログインユーザーのみパーソナライズされた推薦を表示。未ログインは人気キャラクターを表示。,

13. 非機能要件,パフォーマンス,検索結果・ランキングはキャッシュ（Redis）。1時間ごとに更新。ページネーション対応。,
,セキュリティ,検索クエリはサニタイズ。SQLインジェクション対策。,
,スケーラビリティ,ベクトル検索はpgvectorでインデックス最適化。大量データにも対応。,
,可用性,API失敗時はキャッシュからフォールバック。エラー時は適切なエラーメッセージ表示。,

14. テスト観点,項目,テストケース
,キーワード検索,正常系：キーワードでキャラクター検索成功・部分一致確認
,カテゴリーフィルター,カテゴリー選択でフィルタリング動作確認
,ハッシュタグ検索,ハッシュタグでキャラクター検索成功
,人気ランキング,人気度計算式に基づいてランキング表示確認
,新規ランキング,作成日時順に新しいキャラクターをランキング表示確認
,トレンド表示,24時間以内の急増キャラクターをトレンドとして表示確認
,パーソナライズ推薦,ログインユーザーの過去データに基づいて推薦表示確認
,並び替え,各並び替えオプションで正しくソートされることを確認
,ページネーション,ページ切り替えで正しくデータが表示されることを確認
,検索結果なし,検索結果0件時に適切なメッセージ表示確認

15. 今後の拡張余地,項目,提案内容
,音声検索,音声入力による検索機能
,画像検索,画像をアップロードして類似キャラクターを検索
,高度な検索,複雑な条件を組み合わせた検索機能
,検索履歴,過去の検索キーワードを保存・表示
,検索トレンド,人気の検索キーワードをランキング表示
,ユーザー検索,キャラクターだけでなくユーザーも検索可能に
,コラボレーティブフィルタリング,ユーザー間の類似性に基づく推薦


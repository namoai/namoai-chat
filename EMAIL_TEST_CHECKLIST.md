# 📧 メール認証システム テストチェックリスト

## ✅ テスト前の準備

### 1. 環境変数設定確認

`.env.local` ファイル（または本番環境の環境変数）に以下を設定してください：

```bash
# Gmail SMTP設定
EMAIL_USER=namoai.namos@gmail.com
EMAIL_PASSWORD=xbazodjqrgvayqhk  # アプリパスワード（スペースなし）

# アプリURL（認証リンク生成用）
NEXT_PUBLIC_APP_URL=http://localhost:3000  # ローカル開発時
# または
NEXT_PUBLIC_APP_URL=https://your-domain.com  # 本番環境
```

### 2. Gmailアプリパスワード確認

- ✅ Gmailアカウントで2段階認証が有効化されているか
- ✅ アプリパスワードが正しく生成されているか
- ✅ アプリパスワードにスペースが含まれていないか（スペース削除済み）

---

## 🧪 テスト手順

### テスト 1: 会員登録 → メール認証

1. **会員登録**
   - `/register` ページで新規会員登録
   - **メールアドレス**: テスト用の実在するメールアドレスを入力
   - 登録完了メッセージを確認

2. **メール受信確認**
   - 登録したメールアドレスの受信箱を確認
   - 件名: `【NAMOSAI】メールアドレス認証` のメールが届いているか確認
   - メールが届かない場合: 迷惑メールフォルダも確認

3. **認証リンククリック**
   - メール内の「メールアドレスを認証する」ボタンをクリック
   - または、メール内のリンクをコピーしてブラウザで開く
   - `/login?verified=true` にリダイレクトされることを確認

4. **ログインテスト**
   - 認証完了後、ログインページでログイン
   - 正常にログインできることを確認

---

### テスト 2: 認証メール再送信

1. **未認証アカウントでログイン試行**
   - メール認証が未完了のアカウントでログイン試行
   - エラーメッセージが表示されることを確認

2. **再送信ボタンクリック**
   - エラーダイアログの「再送信」ボタンをクリック
   - 再送信成功メッセージが表示されることを確認

3. **メール受信確認**
   - 新しい認証メールが届いているか確認

---

### テスト 3: ログイン失敗回数制限

1. **間違ったパスワードでログイン試行**
   - 同じアカウントで間違ったパスワードを10回入力
   - 10回目でアカウントロックメッセージが表示されることを確認

2. **ロック状態確認**
   - ロックメッセージに「15分後に再試行」と表示されることを確認
   - 15分以内はログイン不可であることを確認

3. **ログイン成功時のリセット確認**
   - 正しいパスワードでログイン成功
   - 失敗回数がリセットされることを確認

---

## ⚠️ よくある問題と対処法

### 問題 1: メールが届かない

**原因:**
- Gmailのアプリパスワードが正しく設定されていない
- メールアドレスが間違っている
- 迷惑メールフォルダに入っている

**対処法:**
1. 環境変数 `EMAIL_PASSWORD` を確認（アプリパスワードが正しいか）
2. 登録したメールアドレスを再確認
3. 迷惑メールフォルダを確認
4. Gmailの送信ログを確認（サーバーログにエラーが出ていないか）

---

### 問題 2: 「認証に失敗しました」エラー

**原因:**
- Gmailのアプリパスワードが間違っている
- 2段階認証が有効化されていない

**対処法:**
1. Gmailアカウントで2段階認証を有効化
2. 新しいアプリパスワードを生成
3. 環境変数を更新

---

### 問題 3: 認証リンクが無効

**原因:**
- トークンの有効期限（24時間）が過ぎた
- 既に使用済みのトークン

**対処法:**
1. 認証メールを再送信
2. 新しいトークンで再度認証

---

## 📊 テスト結果記録

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| 会員登録 → メール送信 | ⬜ | |
| 認証リンククリック | ⬜ | |
| 認証後のログイン | ⬜ | |
| メール再送信 | ⬜ | |
| ログイン失敗制限（10回） | ⬜ | |
| アカウントロック（15分） | ⬜ | |

---

**テスト日**: ___________  
**テスト担当者**: ___________





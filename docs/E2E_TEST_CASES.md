# E2E テストケース一覧

**最終更新**: 2025年12月22日  
**対象環境**: develop環境（NAMOAIChat）

---

## 📊 テストケース概要

| カテゴリ | テスト数 | P0 | P1 | P2 | テストファイル |
|---------|---------|----|----|----|--------------|
| ポイント関連（クリティカル） | 6 | 6 | 0 | 0 | `points-critical.spec.ts` |
| 認証機能 | 8 | 0 | 3 | 5 | `user-auth.spec.ts` |
| キャラクター機能 | 7 | 0 | 4 | 3 | `user-character.spec.ts` |
| チャット機能 | 7 | 0 | 4 | 3 | `chat.spec.ts` |
| ポイント・決済機能 | 4 | 0 | 2 | 2 | `user-points.spec.ts` |
| ソーシャル機能 | 10 | 0 | 5 | 5 | `user-social.spec.ts` |
| 通知機能 | 6 | 0 | 3 | 3 | `user-notifications.spec.ts` |
| ランキング機能 | 3 | 0 | 2 | 1 | `user-ranking.spec.ts` |
| お問い合わせ・通報 | 4 | 0 | 2 | 2 | `user-inquiries.spec.ts` |
| ペルソナ機能 | 5 | 0 | 2 | 3 | `user-persona.spec.ts` |
| お知らせ・ガイド・約款 | 4 | 0 | 2 | 2 | `user-notices.spec.ts` |
| 管理者機能 | 42 | 0 | 25 | 17 | `admin-*.spec.ts` |
| その他機能 | 16 | 0 | 8 | 8 | `misc-features.spec.ts` |
| **合計** | **122** | **6** | **60** | **56** | - |

---

## 🔴 P0: クリティカルテスト（必須）

### ポイント関連クリティカルテスト

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| P0-1 | 新規登録 → 初期ポイント確認 → チャット1往復 → ポイント減少 | ユーザー登録後、初期ポイントを確認し、チャット1往復でポイントが正しく減少することを確認 | 初期ポイントが表示され、チャット後にポイントが減少する |
| P0-2 | 画像作成 → 生成成功 → ポイント減少（失敗時は減らない） | 画像生成が成功した場合のみポイントが減少し、失敗時はポイントが減らないことを確認 | 成功時のみポイント減少、失敗時はポイント不変 |
| P0-3 | ポイント0でチャット不可 → 「ポイント購入が必要です」表示 + 購入導線 | ポイントが0の状態でチャットを試みると、エラーメッセージと購入導線が表示されることを確認 | エラーメッセージ表示、購入ページへのリンク表示 |
| P0-4 | ポイント0で画像作成不可 → 同上 | ポイントが0の状態で画像生成を試みると、エラーメッセージと購入導線が表示されることを確認 | エラーメッセージ表示、購入ページへのリンク表示 |
| P0-5 | 通信断/LLM失敗時 → エラー表示 + ポイント減らない + 再試行できる | ネットワークエラーやLLM失敗時にエラーが表示され、ポイントが減らず、再試行できることを確認 | エラー表示、ポイント不変、再試行可能 |
| P0-6 | ログアウト→再ログインでキャラ/履歴/ポイント保持 | ログアウト後、再ログイン時にキャラクター、チャット履歴、ポイントが保持されることを確認 | データが正しく保持される |

**テストファイル**: `e2e/points-critical.spec.ts`

---

## 🟡 P1: 重要テスト

### 認証機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-1-1 | メールアドレス 회원가입 | メールアドレスで新規登録できることを確認 | 登録成功、プロフィール完成ページへリダイレクト |
| 1-1-3 | メールアドレス 로그인 | 正しい認証情報でログインできることを確認 | ログイン成功、ホームページにリダイレクト |
| 1-1-5 | ログアウト | ログアウトボタンでログアウトできることを確認 | ログアウト成功、ログインページにリダイレクト |
| 1-1-6 | パスワード変更 | パスワードを変更できることを確認 | 変更成功、新しいパスワードでログイン可能 |

**テストファイル**: `e2e/user-auth.spec.ts`

### チャット機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-4-1 | チャット開始（新規） | キャラクター詳細ページからチャットを開始できることを確認 | チャットページに移動、最初のメッセージが表示 |
| 1-4-2 | メッセージ送信・受信 | メッセージを送信し、AI応答を受信できることを確認 | メッセージ送信成功、AI応答が表示 |
| 1-4-3 | チャット履歴確認 | 過去のチャット履歴が正しく表示されることを確認 | 履歴が正しく表示される |
| 1-4-4 | チャットキャンセル | チャットをキャンセルできることを確認 | キャンセル成功、ポイント返金 |
| 1-4-5 | チャットノート作成 | チャットノートを作成できることを確認 | ノート保存成功、次回アクセス時に保持 |
| 1-4-6 | セーフティフィルター制約確認 | セーフティフィルターON時、OFFキャラクターとチャットできないことを確認 | エラーメッセージ表示 |
| 1-4-7 | チャットランキング反映確認 | チャット後、ランキングに反映されることを確認 | ランキングに反映 |

**テストファイル**: `e2e/chat.spec.ts`, `e2e/misc-features.spec.ts`

### キャラクター機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-2-1 | キャラクター検索 | キーワードでキャラクターを検索できることを確認 | 検索結果が表示される |
| 1-2-2 | キャラクター一覧確認 | キャラクター一覧が正しく表示されることを確認 | 一覧が表示される |
| 1-2-3 | キャラクター詳細確認 | キャラクター詳細情報が正しく表示されることを確認 | 詳細情報が表示される |
| 1-2-4 | ブロックした作成者のキャラクター検索除外 | ブロックしたユーザーのキャラクターが検索結果に表示されないことを確認 | 検索結果から除外 |
| 1-3-2 | キャラクター作成（手動入力） | 手動でキャラクターを作成できることを確認 | 作成成功、一覧に表示 |
| 1-3-3 | キャラクター編集 | キャラクター情報を編集できることを確認 | 編集成功、変更反映 |
| 1-3-5 | キャラクタークローン | 他ユーザーのキャラクターをクローンできることを確認 | クローン成功、自分の一覧に追加 |

**テストファイル**: `e2e/user-character.spec.ts`

### 管理者機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 2-1-1 | 管理者ログイン | 管理者アカウントでログインできることを確認 | ログイン成功、管理ダッシュボード表示 |
| 2-1-2 | 権限別アクセス制御確認 | 権限に応じてアクセス可能なメニューが制限されることを確認 | 権限に応じたメニュー表示 |
| 2-2-1 | ユーザー一覧確認 | ユーザー一覧が正しく表示されることを確認 | 一覧が表示される |
| 2-2-2 | ユーザー検索（メール/ID） | 管理者がユーザーを検索できることを確認 | 検索結果が表示される |
| 2-2-3 | ユーザー権限変更 | ユーザーの権限を変更できることを確認 | 権限変更成功 |
| 2-2-4 | ユーザー情報編集 | ユーザー情報を編集できることを確認 | 編集成功、変更反映 |
| 2-2-5 | ユーザー停止 | ユーザーを停止できることを確認 | 停止成功、停止状態表示 |
| 2-2-6 | ユーザー停止解除 | 停止されたユーザーを解除できることを確認 | 解除成功 |
| 2-2-8 | ユーザー削除 | ユーザーを削除できることを確認 | 削除成功、一覧から削除 |
| 2-3-1 | キャラクター一覧確認 | キャラクター一覧が正しく表示されることを確認 | 一覧が表示される |
| 2-3-2 | キャラクター検索 | キャラクターを検索できることを確認 | 検索結果が表示される |
| 2-3-3 | キャラクター公開/非公開切替 | キャラクターの公開状態を変更できることを確認 | 状態変更成功 |
| 2-3-5 | キャラクター削除 | キャラクターを削除できることを確認 | 削除成功 |
| 2-3-7 | ナモアイフレンズ登録/解除 | 公式キャラクターとして登録/解除できることを確認 | 登録/解除成功 |
| 2-4-1 | お知らせ一覧確認 | お知らせ一覧が正しく表示されることを確認 | 一覧が表示される |
| 2-4-2 | お知らせ作成 | お知らせを作成できることを確認 | 作成成功、一般ユーザー画面に表示 |
| 2-8-1 | 通報一覧確認 | 通報一覧が正しく表示されることを確認 | 一覧が表示される |
| 2-8-2 | 通報フィルタリング | 通報をフィルタリングできることを確認 | フィルタリング結果が表示 |
| 2-8-4 | 通報状態変更 | 通報の状態を変更できることを確認 | 状態変更成功 |

**テストファイル**: `e2e/admin-user-management.spec.ts`, `e2e/admin-character-management.spec.ts`, `e2e/admin-notices.spec.ts`, `e2e/admin-reports.spec.ts`

---

## 🟢 P2: 通常テスト

### 認証機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-1-2 | Google 계정 회원가입 | Googleアカウントで新規登録できることを確認 | 登録成功 |
| 1-1-4 | Google 계정 로그인 | Googleアカウントでログインできることを確認 | ログイン成功 |
| 1-1-7 | 2FA (2단계 인증) 활성화 | 2FAを有効化できることを確認 | 有効化成功 |
| 1-1-8 | 이메일 인증 | メール認証が正しく動作することを確認 | 認証成功 |

### チャット機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-4-4 | チャットキャンセル | チャットをキャンセルできることを確認 | キャンセル成功 |
| 1-4-5 | チャットノート作成 | チャットノートを作成できることを確認 | ノート保存成功 |

### キャラクター機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-3-1 | キャラクター作成（AI生成） | AI生成機能を使ってキャラクターを作成できることを確認 | 作成成功 |
| 1-3-4 | キャラクター削除 | キャラクターを削除できることを確認 | 削除成功 |
| 1-3-6 | キャラクターExport | キャラクターをExportできることを確認 | JSONファイルダウンロード |
| 1-3-7 | キャラクターImport | キャラクターをImportできることを確認 | Import成功 |

### ソーシャル機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-6-2 | 他ユーザーのプロフィール確認 | 他ユーザーのプロフィールを確認できることを確認 | プロフィール表示 |
| 1-6-4 | フォロワー/フォロー中一覧確認 | フォロワー/フォロー中一覧を確認できることを確認 | 一覧表示 |
| 1-6-5 | ユーザーブロック/アンブロック | ユーザーをブロック/アンブロックできることを確認 | ブロック/アンブロック成功 |
| 1-6-6 | ブロックしたユーザー一覧確認 | ブロックしたユーザー一覧を確認できることを確認 | 一覧表示 |
| 1-6-9 | コメント削除 | コメントを削除できることを確認 | 削除成功 |

### 通知機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 1-7-3 | 通知削除 | 通知を削除できることを確認 | 削除成功 |
| 1-7-5 | フォロー通知確認 | フォロー通知が正しく表示されることを確認 | 通知表示 |
| 1-7-6 | いいね通知確認 | いいね通知が正しく表示されることを確認 | 通知表示 |

### その他機能

| ID | テストケース名 | 説明 | 期待結果 |
|---|--------------|------|---------|
| 3-1 | お問い合わせ（すべての種類） | すべての種類のお問い合わせを作成できることを確認 | 作成成功 |
| 3-6 | ペルソナ（チャットで使用） | ペルソナをチャットで使用できることを確認 | 使用成功 |
| 3-7 | 画像生成 | 画像生成機能が正しく動作することを確認 | 生成成功 |
| 3-8 | クローン | キャラクターをクローンできることを確認 | クローン成功 |
| 3-9 | Export/Import | キャラクターをExport/Importできることを確認 | Export/Import成功 |
| 3-12 | チャット詳細機能 | メモリー、ノート、キャンセル機能が正しく動作することを確認 | 各機能が動作 |
| 3-13 | プロフィール（統計、編集） | プロフィールの統計と編集が正しく動作することを確認 | 統計表示、編集成功 |
| 3-14 | 検索（ハッシュタグ、名前/説明、ソート） | 検索機能が正しく動作することを確認 | 検索結果表示 |
| 3-16 | エラーハンドリング | エラーが正しく処理されることを確認 | エラーメッセージ表示 |

---

## 📝 テスト実行方法

### すべてのテストを実行

```bash
npm run test:e2e
```

### P0テストのみ実行

```bash
npm run test:e2e -- e2e/points-critical.spec.ts
```

### 特定のテストケースを実行

```bash
npm run test:e2e -- --grep "P0-1"
```

### UIモードで実行（デバッグ）

```bash
npm run test:e2e:ui
```

---

## 🔍 テスト結果の確認

### HTMLレポート

```bash
npm run test:e2e:report
```

### スクリーンショットとトレース

失敗したテストのスクリーンショットとトレースは `test-results/` ディレクトリに自動保存されます。

---

## 📌 注意事項

1. **P0テストは必ず通過すること**: P0テストが失敗した場合、本番環境へのデプロイを停止してください。

2. **テスト環境の準備**: テスト実行前に、テスト用のデータベースとテストユーザーを準備してください。

3. **環境変数の設定**: テスト実行前に必要な環境変数を設定してください。

4. **並列実行**: CI環境では並列実行が制限される場合があります（`workers: 1`）。

---

## 🔄 テストケースの更新

新しい機能が追加された場合、このドキュメントとテストケースを更新してください。

1. 新しいテストケースを追加
2. 優先度（P0/P1/P2）を決定
3. テストファイルを作成/更新
4. このドキュメントを更新

---

**参考**: 
- [E2Eテストシナリオ（詳細）](../E2E_TEST_SCENARIOS_JA.md)
- [E2Eテスト実行ガイド](../e2e/README.md)


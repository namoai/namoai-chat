# E2E テストシナリオ詳細 (日本語)

**最終更新**: 2025-12-24  
**参考**: シナリオの状態は `E2E_TEST_SCENARIOS_JA.md` を参照

---

## 🔴 P0: クリティカルテスト（必須）

### P0-1: 新規登録/ログイン → 初期ポイント確認 → チャット1往復 → ポイント減少
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: ユーザー登録後、初期ポイントを確認し、チャット1往復でポイントが正しく減少することを確認

**詳細ステップ**:
1. テスト用ユーザーを作成（または既存ユーザーでログイン）
2. ログイン実行
3. 初期ポイントを確認（UI表示）
4. 初期ポイントを確認（APIレスポンス）
5. キャラクター一覧から最初のキャラクターを選択
6. キャラクター詳細ページでチャット開始
7. チャット1往復（メッセージ送信 → AI応答受信）
8. ポイント減少を確認（UI表示）
9. ポイント減少を確認（APIレスポンス）

**期待結果**: 初期ポイントが正しく表示され、チャット後にポイントが減少する

---

### P0-2: 画像作成 → 生成成功 → ポイント減少（失敗時は減らない）
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: 画像生成が成功した場合のみポイントが減少し、失敗時はポイントが減らないことを確認

**詳細ステップ**:
1. ログイン
2. 初期ポイントを確認（API）
3. キャラクター作成ページに移動
4. 画像生成機能を探す
5. 画像生成モーダルを開く
6. プロンプトを入力
7. 生成ボタンをクリック
8. 画像生成完了を待つ（最大60秒）
9. 成功時: ポイント減少を確認
10. 失敗時: ポイントが減っていないことを確認

**期待結果**: 成功時のみポイントが減少し、失敗時はポイントが減らない

---

### P0-3: ポイント0でチャット不可 → 「ポイント購入が必要です」表示 + 購入導線
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: ポイントが0の状態でチャットを試みると、エラーメッセージと購入導線が表示されることを確認

**期待結果**: ポイントが0のとき、チャット不可メッセージと購入導線が表示される

---

### P0-4: ポイント0で画像作成不可 → 同上
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: ポイントが0の状態で画像生成を試みると、エラーメッセージと購入導線が表示されることを確認

**期待結果**: ポイントが0のとき、画像作成不可メッセージと購入導線が表示される

---

### P0-5: 通信断/LLM失敗時 → エラー表示 + ポイント減らない + 再試行できる
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: ネットワークエラーやLLM失敗時にエラーが表示され、ポイントが減らず、再試行できることを確認

**期待結果**: エラー表示、ポイント減少なし、再試行可能

---

### P0-6: ログアウト→再ログインでキャラ/履歴/ポイント保持
**ファイル**: `e2e/points-critical.spec.ts`

**説明**: ログアウト後、再ログイン時にキャラクター、チャット履歴、ポイントが保持されることを確認

**期待結果**: 再ログイン時にすべてのデータが保持される

---

## 🟡 P1: 重要テスト

### 認証機能

#### 1-1-1: メールアドレス 会員登録
**ファイル**: `e2e/user-auth.spec.ts`

**説明**: メールアドレスで新規登録できることを確認

**詳細**: メール認証が必要なため、E2Eテストではスキップ

---

#### 1-1-3: メールアドレス ログイン
**ファイル**: `e2e/user-auth.spec.ts`

**説明**: 正しい認証情報でログインできることを確認

---

#### 1-1-4: ログイン失敗（間違ったパスワード）
**ファイル**: `e2e/user-auth.spec.ts`

**説明**: 間違ったパスワードでログインできないことを確認

---

### キャラクター機能

#### 1-2-1: キャラクター検索
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キーワードでキャラクターを検索できることを確認

---

#### 1-2-2: キャラクター一覧確認
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクター一覧が正しく表示されることを確認

---

#### 1-2-3: キャラクター詳細確認
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクター詳細情報が正しく表示されることを確認

---

#### 1-3-1: キャラクター作成 (AI生成機能使用)
**ファイル**: `e2e/user-character.spec.ts`

**説明**: AI生成機能を使用してキャラクターを作成できることを確認（ボタン存在確認のみ）

---

#### 1-3-2: キャラクター作成（手動入力）
**ファイル**: `e2e/user-character.spec.ts`

**説明**: 手動でキャラクターを作成できることを確認

---

### チャット機能

#### 1-4-1: チャット開始（新規）
**ファイル**: `e2e/chat.spec.ts`

**説明**: キャラクター詳細ページからチャットを開始できることを確認

---

#### 1-4-2: メッセージ送信・受信
**ファイル**: `e2e/chat.spec.ts`

**説明**: メッセージを送信し、AI応答を受信できることを確認

---

#### 1-4-2-2: AI応答受信
**ファイル**: `e2e/chat.spec.ts`

**説明**: AI応答を受信できることを確認

---

#### 1-4-3: チャット履歴確認
**ファイル**: `e2e/chat.spec.ts`

**説明**: 過去のチャット履歴が正しく表示されることを確認

---

### ポイント・決済機能

#### 1-5-1: ポイント残高確認
**ファイル**: `e2e/user-points.spec.ts`

**説明**: ポイント残高が正しく表示されることを確認

---

#### 1-5-3: 出席チェック
**ファイル**: `e2e/user-points.spec.ts`

**説明**: 出席チェックでポイントが付与されることを確認

---

### ソーシャル機能

#### 1-6-1: 自分のプロフィール確認
**ファイル**: `e2e/user-social.spec.ts`

**説明**: 自分のプロフィール情報が正しく表示されることを確認

---

#### 1-6-2: 他ユーザーのプロフィール確認
**ファイル**: `e2e/user-social.spec.ts`

**説明**: 他ユーザーのプロフィールを確認できることを確認

---

#### 1-6-3: フォロー/アンフォロー
**ファイル**: `e2e/user-social.spec.ts`

**説明**: ユーザーをフォロー/アンフォローできることを確認

---

#### 1-6-7: いいね機能
**ファイル**: `e2e/user-social.spec.ts`

**説明**: キャラクターにいいねできることを確認

---

### 通知機能

#### 1-7-1: 通知一覧確認
**ファイル**: `e2e/user-notifications.spec.ts`

**説明**: 通知一覧が正しく表示されることを確認

---

#### 1-7-2: 通知既読処理
**ファイル**: `e2e/user-notifications.spec.ts`

**説明**: 通知を既読にできることを確認

---

#### 1-7-4: 未読通知数確認
**ファイル**: `e2e/user-notifications.spec.ts`

**説明**: 未読通知数が正しく表示されることを確認

---

### ランキング機能

#### 1-8-1: リアルタイムランキング確認
**ファイル**: `e2e/user-ranking.spec.ts`

**説明**: リアルタイムランキングが正しく表示されることを確認

---

#### 1-8-2: 日次/週次/月次ランキング確認
**ファイル**: `e2e/user-ranking.spec.ts`

**説明**: 期間別ランキングが正しく表示されることを確認

---

### お問い合わせ・通報

#### 1-9-1: お問い合わせ作成
**ファイル**: `e2e/user-inquiries.spec.ts`

**説明**: お問い合わせを作成できることを確認

---

#### 1-9-2: キャラクター通報
**ファイル**: `e2e/user-inquiries.spec.ts`

**説明**: キャラクターを通報できることを確認

---

### ペルソナ機能

#### 1-10-1: ペルソナ一覧確認
**ファイル**: `e2e/user-persona.spec.ts`

**説明**: ペルソナ一覧が正しく表示されることを確認

---

#### 1-10-2: ペルソナ作成
**ファイル**: `e2e/user-persona.spec.ts`

**説明**: ペルソナを作成できることを確認

---

### お知らせ・ガイド・約款

#### 1-11-1: お知らせ一覧確認
**ファイル**: `e2e/user-notices.spec.ts`

**説明**: お知らせ一覧が正しく表示されることを確認

---

#### 1-11-2: お知らせ詳細確認
**ファイル**: `e2e/user-notices.spec.ts`

**説明**: お知らせ詳細が正しく表示されることを確認

---

## 🟢 P2: 通常テスト

### 認証機能

#### 1-1-5: ログアウト
**ファイル**: `e2e/user-auth.spec.ts`

**説明**: ログアウトできることを確認

---

#### 1-1-6: パスワード変更
**ファイル**: `e2e/user-auth.spec.ts`

**説明**: パスワードを変更できることを確認

---

### キャラクター機能

#### 1-2-4: ブロックした作成者のキャラクター検索除外
**ファイル**: `e2e/user-character.spec.ts`

**説明**: ブロックしたユーザーのキャラクターが検索結果に表示されないことを確認

---

#### 1-3-3: キャラクター編集
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクター情報を編集できることを確認

---

#### 1-3-4: キャラクター削除
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクターを削除できることを確認

---

#### 1-3-5: キャラクタークローン
**ファイル**: `e2e/user-character.spec.ts`

**説明**: 他ユーザーのキャラクターをクローンできることを確認

---

#### 1-3-6: キャラクターExport
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクターをExportできることを確認

---

#### 1-3-7: キャラクターImport
**ファイル**: `e2e/user-character.spec.ts`

**説明**: キャラクターをImportできることを確認

---

### チャット機能

#### 1-4-4: チャットキャンセル
**ファイル**: `e2e/chat.spec.ts`

**説明**: チャットをキャンセルできることを確認

---

### ポイント・決済機能

#### 1-5-4: ポイント使用確認
**ファイル**: `e2e/user-points.spec.ts`

**説明**: チャットでポイントが使用されることを確認

---

### ソーシャル機能

#### 1-6-8: コメント作成
**ファイル**: `e2e/user-social.spec.ts`

**説明**: コメントを作成できることを確認

---

### ランキング機能

#### 1-8-3: ランキングからキャラクターをクリック
**ファイル**: `e2e/user-ranking.spec.ts`

**説明**: ランキングからキャラクター詳細に移動できることを確認

---

### お問い合わせ・通報

#### 1-9-3: 自分のお問い合わせ/通報一覧確認
**ファイル**: `e2e/user-inquiries.spec.ts`

**説明**: 自分のお問い合わせ/通報一覧を確認できることを確認

---

### ペルソナ機能

#### 1-10-3: ペルソナ編集
**ファイル**: `e2e/user-persona.spec.ts`

**説明**: ペルソナを編集できることを確認

---

#### 1-10-4: ペルソナ削除
**ファイル**: `e2e/user-persona.spec.ts`

**説明**: ペルソナを削除できることを確認

---

### お知らせ・ガイド・約款

#### 1-11-3: ガイド確認
**ファイル**: `e2e/user-notices.spec.ts`

**説明**: ガイドを確認できることを確認

---

#### 1-11-4: 約款確認
**ファイル**: `e2e/user-notices.spec.ts`

**説明**: 約款を確認できることを確認

---

## 📋 管理者シナリオ

### ユーザー管理

#### 2-2-1: ユーザー一覧確認
**ファイル**: `e2e/admin-user-management.spec.ts`

**説明**: ユーザー一覧が正しく表示されることを確認

---

#### 2-2-2: ユーザー検索（メール/ID）
**ファイル**: `e2e/admin-user-management.spec.ts`

**説明**: ユーザーを検索できることを確認

---

#### 2-2-3: ユーザー権限変更
**ファイル**: `e2e/admin-user-management.spec.ts`

**説明**: ユーザーの権限を変更できることを確認

---

#### 2-2-4: ユーザー情報編集
**ファイル**: `e2e/admin-user-management.spec.ts`

**説明**: ユーザー情報を編集できることを確認

---

#### 2-2-5: ユーザー停止
**ファイル**: `e2e/admin-user-management.spec.ts`

**説明**: ユーザーを停止できることを確認

---

### キャラクター管理

#### 2-3-1: キャラクター一覧確認
**ファイル**: `e2e/admin-character-management.spec.ts`

**説明**: キャラクター一覧が正しく表示されることを確認

---

#### 2-3-3: キャラクター公開/非公開切替
**ファイル**: `e2e/admin-character-management.spec.ts`

**説明**: キャラクターの公開状態を変更できることを確認

---

#### 2-3-5: キャラクター削除
**ファイル**: `e2e/admin-character-management.spec.ts`

**説明**: キャラクターを削除できることを確認

---

#### 2-3-7: ナモアイフレンズ登録/解除
**ファイル**: `e2e/admin-character-management.spec.ts`

**説明**: 公式キャラクターとして登録/解除できることを確認

---

### その他管理者機能

#### 2-4-1: お知らせ一覧確認
**ファイル**: `e2e/admin-notices.spec.ts`

**説明**: お知らせ一覧が正しく表示されることを確認

---

#### 2-4-2: お知らせ作成
**ファイル**: `e2e/admin-notices.spec.ts`

**説明**: お知らせを作成できることを確認

---

#### 2-5-1: ガイド一覧確認
**ファイル**: `e2e/admin-guides.spec.ts`

**説明**: ガイド一覧が正しく表示されることを確認

---

#### 2-5-2: ガイド作成
**ファイル**: `e2e/admin-guides.spec.ts`

**説明**: ガイドを作成できることを確認

---

#### 2-6-1: バナー一覧確認
**ファイル**: `e2e/admin-banners.spec.ts`

**説明**: バナー一覧が正しく表示されることを確認

---

#### 2-6-2: バナー作成
**ファイル**: `e2e/admin-banners.spec.ts`

**説明**: バナーを作成できることを確認

---

#### 2-7-1: 約款一覧確認
**ファイル**: `e2e/admin-terms.spec.ts`

**説明**: 約款一覧が正しく表示されることを確認

---

#### 2-7-2: 約款編集
**ファイル**: `e2e/admin-terms.spec.ts`

**説明**: 約款を編集できることを確認

---

#### 2-8-1: 通報一覧確認
**ファイル**: `e2e/admin-reports.spec.ts`

**説明**: 通報一覧が正しく表示されることを確認

---

#### 2-8-2: 通報フィルタリング
**ファイル**: `e2e/admin-reports.spec.ts`

**説明**: 通報をフィルタリングできることを確認

---

#### 2-8-4: 通報状態変更
**ファイル**: `e2e/admin-reports.spec.ts`

**説明**: 通報の状態を変更できることを確認

---

#### 2-10-1: IPブロック
**ファイル**: `e2e/admin-ip-management.spec.ts`

**説明**: IPをブロックできることを確認

---

#### 2-10-2: IPブロック解除
**ファイル**: `e2e/admin-ip-management.spec.ts`

**説明**: IPブロックを解除できることを確認

---

#### 2-10-3: IPモニタリング
**ファイル**: `e2e/admin-ip-management.spec.ts`

**説明**: IPアクセスをモニタリングできることを確認

---

## 📋 その他機能

#### 3-3-1: チャット後ランキング反映確認
**ファイル**: `e2e/misc-features.spec.ts`

**説明**: チャット後、ランキングに反映されることを確認

---

#### 3-5-1: セーフティフィルターON時OFFキャラクターブロック
**ファイル**: `e2e/misc-features.spec.ts`

**説明**: セーフティフィルターON時、OFFキャラクターとチャットできないことを確認

---

#### 3-12-2: チャットノート機能
**ファイル**: `e2e/misc-features.spec.ts`

**説明**: チャットノートを作成できることを確認

---

## 📋 追加ユーザーシナリオ

### 認証機能（追加）

#### AUTH-1: メールアドレスとパスワードでログインできる
**ファイル**: `e2e/auth.spec.ts`

**説明**: メールアドレスとパスワードでログインできることを確認

---

#### AUTH-2: ログアウトできる
**ファイル**: `e2e/auth.spec.ts`

**説明**: ログアウトできることを確認

---

#### AUTH-3: 間違ったパスワードでログインできない
**ファイル**: `e2e/auth.spec.ts`

**説明**: 間違ったパスワードでログインできないことを確認

---

### キャラクター検索機能

#### CHAR-SEARCH-1: キャラクター一覧ページが表示される
**ファイル**: `e2e/character-search.spec.ts`

**説明**: キャラクター一覧ページが正しく表示されることを確認

---

#### CHAR-SEARCH-2: キャラクターを検索できる
**ファイル**: `e2e/character-search.spec.ts`

**説明**: キーワードでキャラクターを検索できることを確認

---

#### CHAR-SEARCH-3: キャラクター詳細ページに遷移できる
**ファイル**: `e2e/character-search.spec.ts`

**説明**: キャラクター詳細ページに遷移できることを確認

---

### ユーザージャーニー

#### JOURNEY-1: ログインからチャットまでの一連の流れ
**ファイル**: `e2e/user-journey.spec.ts`

**説明**: ログインからチャット開始までの全体の流れが正常に動作することを確認

---

## 📌 参考事項

- 各シナリオの状態は `E2E_TEST_SCENARIOS_JA.md` を参照
- テストファイル位置: `e2e/*.spec.ts`
- 優先度: P0 (クリティカル) > P1 (重要) > P2 (通常)
- 総ユーザーシナリオ: 52個（ドキュメント基準 40個 + 追加 12個）


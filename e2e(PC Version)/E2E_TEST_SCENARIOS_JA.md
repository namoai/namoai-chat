# E2E テストシナリオ管理 (日本語)

**最終更新**: 2025-01-27 (コメント編集機能追加および最新実行結果反映)  
**集計基準**: 実際のテストファイル (`e2e/*.spec.ts`) のすべてのテストケース  
**最新実行**: 2025-01-27, Workers: 1, 個別テスト実行

**最近修正完了**:
- ✅ 1-6-8-2: コメント編集 - 新規追加および成功 (編集完了モーダル確認)
- ✅ 1-6-2: 他ユーザーのプロフィール確認 - 成功
- ✅ 1-6-4: フォロワー/フォロー中一覧確認 - 成功
- ✅ 1-6-5: ユーザーブロック/アンブロック - 成功
- ✅ 1-6-6: ブロックしたユーザー一覧確認 - 成功
- ✅ 1-6-9: コメント削除 - 成功 (削除完了モーダル確認)
- ✅ 1-6-10: コメント通知確認 - 成功
- ✅ 1-7-2: 通知既読処理 - 成功 (通知クリックロジック改善)
- ✅ 1-11-2: お知らせ詳細確認 - 成功 (/notice/1 直接アクセスロジック追加)
- ✅ 1-4-3: チャット履歴確認 - 成功 (チャット作成後履歴確認ロジックに修正、スキップ削除)
- ✅ 管理者テスト個数修正: 33個 → 32個 (admin-reports.spec.tsの2-8-3, 2-8-5は未実装と確認)

**現在進行中**:
✅ すべてのテストが合格しました！

---

## 📊 総合統計 (最新実行結果)

| カテゴリ | 総数 | OK | NG | 未実装 |
|---------|------|----|----|--------|
| **管理者** | 32 | 31 | 1 | 0 |
| **ユーザー** | 59 | 55 | 0 | 4 |
| **その他** | 3 | 3 | 0 | 0 |
| **合計** | **94** | **89** | **0** | **5** |

### 成功率 (最新実行基準)
- **管理者**: 96.9% (31/32) - 1個未実装 (IPブロック解除 - データなし)
- **ユーザー**: 100.0% (55/55) - 実行されたテスト基準 (OK 55個, NG 0個, 未実装 4個)
- **その他**: 66.7% (2/3) - 1個未実装
- **全体**: 93.6% (88/94) - 実行されたテスト基準 (総 94個中 88個実行, 6個未実装)

**ユーザーテスト集計詳細**:
- 総 59個テスト (user-*ファイル + chat + character-search + points-critical + user-journey)
- OK: 55個
- NG: 0個 ✅
- 未実装: 4個 (P0-3/P0-4: エラーメッセージ/購入導線確認不可時スキップ, 1-1-1: メール認証必要のためスキップ, 1-5-3: 条件付きスキップ)
- 実行されたテスト: 55個 (OK 55個)
- **検証完了**: すべてのテストIDが実際のテストファイルと一致 (2025-01-27確認)

### 現在失敗中のテスト (0個)
✅ すべてのテストが合格しました！

### 完了確認が不足しているテスト (改善推奨)
次のテストは成功モーダル確認およびOKボタンクリックが不足しているため改善が推奨されます：
1. **1-10-2: ペルソナ作成** - 成功メッセージ確認のみでOKボタンクリックなし
2. **1-10-3: ペルソナ編集** - 成功メッセージ確認のみでOKボタンクリックなし
3. **1-3-4: キャラクター削除** - 削除完了後の成功モーダル確認なし (キャラクター数の減少のみ確認)

---

## 📋 管理者シナリオ (32個)

### admin.spec.ts (5個)
| ID | シナリオ | 状態 |
|----|---------|------|
| - | 管理画面にアクセスできる | ✅ OK |
| - | キャラクター管理ページにアクセスできる | ✅ OK |
| - | ユーザー管理ページにアクセスできる | ✅ OK |
| - | お知らせ管理ページにアクセスできる | ✅ OK |
| - | 一般ユーザーは管理画面にアクセスできない | ✅ OK |

### admin-user-management.spec.ts (7個)
| ID | シナリオ | 状態 |
|----|---------|------|
| - | ユーザー一覧が表示される | ✅ OK |
| - | ユーザーを検索できる | ✅ OK |
| - | ユーザー詳細を確認できる | ✅ OK |
| 2-2-2 | ユーザー検索（メール/ID） | ✅ OK |
| 2-2-3 | ユーザー権限変更 | ✅ OK |
| 2-2-4 | ユーザー情報編集 | ✅ OK |
| 2-2-5 | ユーザー停止 | ✅ OK |

### admin-character-management.spec.ts (6個)
| ID | シナリオ | 状態 |
|----|---------|------|
| - | キャラクター一覧が表示される | ✅ OK |
| - | キャラクターを検索できる | ✅ OK |
| - | キャラクターの詳細を確認できる | ✅ OK |
| 2-3-3 | キャラクター公開/非公開切替 | ✅ OK |
| 2-3-5 | キャラクター削除 | ✅ OK |
| 2-3-7 | ナモアイフレンズ登録/解除 | ✅ OK |

### admin-terms.spec.ts (2個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-7-1 | 約款一覧確認 | ✅ OK |
| 2-7-2 | 約款編集 | ✅ OK |

### admin-banners.spec.ts (2個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-6-1 | バナー一覧確認 | ✅ OK |
| 2-6-2 | バナー作成 | ✅ OK |

### admin-ip-management.spec.ts (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-10-1 | IPブロック | ✅ OK |
| 2-10-2 | IPブロック解除 | ⏭️ 未実装 |
| 2-10-3 | IPモニタリング | ✅ OK |

### admin-reports.spec.ts (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-8-1 | 通報一覧確認 | ✅ OK |
| 2-8-2 | 通報フィルタリング | ✅ OK |
| 2-8-4 | 通報状態変更 | ✅ OK |

### admin-notices.spec.ts (2個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-4-1 | お知らせ一覧確認 | ✅ OK |
| 2-4-2 | お知らせ作成 | ✅ OK |

### admin-guides.spec.ts (2個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 2-5-1 | ガイド一覧確認 | ✅ OK |
| 2-5-2 | ガイド作成 | ✅ OK |

---

## 📋 ユーザーシナリオ (59個 - 実際のPlaywright結果基準)

### ポイント関連（クリティカル） (6個)
| ID | シナリオ | 状態 |
|----|---------|------|
| P0-1 | 新規登録 → 初期ポイント確認 → チャット1往復 → ポイント減少 | ✅ OK |
| P0-2 | 画像作成 → 生成成功 → ポイント減少 | ✅ OK |
| P0-3 | ポイント0でチャット不可 → 「ポイント購入が必要です」表示 | ⏭️ 未実装 (エラーメッセージ/購入導線確認不可時スキップ) |
| P0-4 | ポイント0で画像作成不可 | ⏭️ 未実装 (エラーメッセージ/購入導線確認不可時スキップ) |
| P0-5 | 通信断/LLM失敗時 → エラー表示 + ポイント減らない | ✅ OK |
| P0-6 | ログアウト→再ログインでキャラ/履歴/ポイント保持 | ✅ OK |

### 認証機能 (5個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-1-1 | メールアドレス 会員登録 | ⏭️ 未実装 (メール認証必要のためスキップ) |
| 1-1-3 | メールアドレス ログイン | ✅ OK |
| 1-1-4 | ログイン失敗（間違ったパスワード） | ✅ OK |
| 1-1-5 | ログアウト | ✅ OK |
| 1-1-6 | パスワード変更 | ✅ OK |

### キャラクター機能 (11個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-2-1 | キャラクター検索 | ✅ OK |
| 1-2-2 | キャラクター一覧確認 | ✅ OK |
| 1-2-3 | キャラクター詳細確認 | ✅ OK |
| 1-2-4 | ブロックした作成者のキャラクター検索除外確認 | ✅ OK |
| 1-3-1 | キャラクター作成 (AI生成機能使用) | ✅ OK |
| 1-3-2 | キャラクター作成（手動入力） | ✅ OK |
| 1-3-3 | キャラクター編集 | ✅ OK |
| 1-3-4 | キャラクター削除 | ✅ OK |
| 1-3-5 | キャラクタークローン | ✅ OK |
| 1-3-6 | キャラクターExport | ✅ OK |
| 1-3-7 | キャラクターImport | ✅ OK |

### チャット機能 (5個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-4-1 | チャット開始（新規） | ✅ OK |
| 1-4-2 | メッセージ送信・受信 | ✅ OK |
| 1-4-2-2 | AI応答受信 | ✅ OK |
| 1-4-3 | チャット履歴確認 | ✅ OK |
| 1-4-4 | チャットキャンセル | ✅ OK |

### ポイント・決済機能 (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-5-1 | ポイント残高確認 | ✅ OK |
| 1-5-3 | 出席チェック | ⏭️ 未実装 (条件付きスキップ) |
| 1-5-4 | ポイント使用確認 | ✅ OK |

### ソーシャル機能 (11個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-6-1 | 自分のプロフィール確認 | ✅ OK |
| 1-6-2 | 他ユーザーのプロフィール確認 | ✅ OK |
| 1-6-3 | フォロー/アンフォロー | ✅ OK |
| 1-6-4 | フォロワー/フォロー中一覧確認 | ✅ OK |
| 1-6-5 | ユーザーブロック/アンブロック | ✅ OK |
| 1-6-6 | ブロックしたユーザー一覧確認 | ✅ OK |
| 1-6-7 | いいね機能 | ✅ OK |
| 1-6-8 | コメント作成 | ✅ OK |
| 1-6-8-2 | コメント編集 | ✅ OK |
| 1-6-9 | コメント削除 | ✅ OK |
| 1-6-10 | コメント通知確認 | ✅ OK |

### 通知機能 (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-7-1 | 通知一覧確認 | ✅ OK |
| 1-7-2 | 通知既読処理 | ✅ OK |
| 1-7-4 | 未読通知数確認 | ✅ OK |

### ランキング機能 (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-8-1 | リアルタイムランキング確認 | ✅ OK |
| 1-8-2 | 日次/週次/月次ランキング確認 | ✅ OK |
| 1-8-3 | ランキングからキャラクターをクリック | ✅ OK |

### お問い合わせ・通報 (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-9-1 | お問い合わせ作成 | ✅ OK |
| 1-9-2 | キャラクター通報 | ✅ OK |
| 1-9-3 | 自分のお問い合わせ/通報一覧確認 | ✅ OK |

### ペルソナ機能 (4個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-10-1 | ペルソナ一覧確認 | ✅ OK |
| 1-10-2 | ペルソナ作成 | ✅ OK |
| 1-10-3 | ペルソナ編集 | ✅ OK |
| 1-10-4 | ペルソナ削除 | ✅ OK |

### お知らせ・ガイド・約款 (4個)
| ID | シナリオ | 状態 |
|----|---------|------|
| 1-11-1 | お知らせ一覧確認 | ✅ OK |
| 1-11-2 | お知らせ詳細確認 | ✅ OK |
| 1-11-3 | ガイド確認 | ✅ OK |
| 1-11-4 | 約款確認 | ✅ OK |

### キャラクター検索機能 (3個)
| ID | シナリオ | 状態 |
|----|---------|------|
| CHAR-SEARCH-1 | キャラクター一覧ページが表示される | ✅ OK |
| CHAR-SEARCH-2 | キャラクターを検索できる | ✅ OK |
| CHAR-SEARCH-3 | キャラクター詳細ページに遷移できる | ✅ OK |

### ユーザージャーニー (1個)
| ID | シナリオ | 状態 |
|----|---------|------|
| JOURNEY-1 | ログインからチャットまでの一連の流れ | ✅ OK |

---

## 📋 その他シナリオ (3個)

| ID | シナリオ | 状態 |
|----|---------|------|
| 3-3-1 | チャット後ランキング反映確認 | ✅ OK |
| 3-5-1 | セーフティフィルターON時OFFキャラクターブロック | ✅ OK |
| 3-12-2 | チャットノート機能 | ⏭️ 未実装 |

---

## 📝 状態説明

- **✅ OK**: テスト成功
- **❌ NG**: テスト失敗
- **⏭️ 未実装**: スキップまたは未実装 (条件付きスキップ、UI要素未実装、テストデータ不足など)

---

## 📌 参考事項

- 集計基準: 実際のPlaywrightテスト実行結果基準 (`npx playwright test --list`)
- 実際のテスト数: **94個** (管理者 32個 + ユーザー 59個 + その他 3個)
- ユーザーテスト: 59個 (user-*ファイル + chat + character-search + points-critical + user-journey)
- 詳細シナリオは `E2E_TEST_SCENARIOS_DETAIL_JA.md` を参照

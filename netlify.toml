[functions]
  included_files = ["gcp/sa.json"]
  # OpenAI Embedding 生成など時間のかかる処理のためタイムアウトを30秒に延長
  node_bundler = "esbuild"

[functions."*"]
  # 全てのFunctionに対して30秒のタイムアウトを設定
  max_duration = 30
  # 画像アップロードのため最大ペイロードサイズを30MBに拡大（Netlifyの最大値）
  # ※ Netlify Proプラン以上で利用可能
  payload_size_limit = "30mb"

[build]
  # ▼▼▼【GSM】ビルド時にGSM認証を設定してNEXT_PUBLIC変数をロード ▼▼▼
  command = "node scripts/load-gsm-secrets.js && npm run build"
  # ▲▲▲

[build.environment]
  # Secret Manager を使用するため secrets scanning を無効化
  SECRETS_SCAN_SMART_DETECTION_ENABLED = "false"
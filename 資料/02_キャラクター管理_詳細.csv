大分類,中分類,項目,詳細内容
━━━ UI基本設計書 ━━━,,,
基本情報,機能名,キャラクター管理,
,対象画面,キャラクター一覧 ・ キャラクター作成 ・ キャラクター編集 ・ キャラクター詳細 ・ 自分のキャラクター管理,
,技術スタック,Next.js 15 ・ TypeScript ・ Prisma ・ PostgreSQL ・ pgvector ・ AWS S3 / Supabase Storage,
,作成日,2025-10-28,
━━━ 1. 画面概要 ━━━,,,
キャラクター一覧ページ,機能,全公開キャラクター表示,公開されている全てのAIキャラクター ・ カテゴリー・ハッシュタグでフィルタリング可能
,ファイル,src/app/charlist/page.tsx,
キャラクター作成ページ,機能,新規キャラクター作成,名前・説明・画像・システムプロンプト・ローブックなど詳細設定
,ファイル,src/app/characters/create/page.tsx,
キャラクター編集ページ,機能,既存キャラクター編集,既存キャラクターの情報を編集 ・ 作成者のみアクセス可能
,ファイル,src/app/characters/edit/[id]/page.tsx,
キャラクター詳細ページ,機能,キャラクター詳細表示,詳細情報表示 ・ お気に入り・コメント・評価機能 ・ チャット開始ボタン
,ファイル,src/app/characters/[characterId]/page.tsx,
自分のキャラクター管理,機能,作成キャラクター管理,ログインユーザーが作成したキャラクターのみを一覧表示 ・ 編集・削除機能付き
,ファイル,src/app/character-management/page.tsx,
━━━ 2. 前提・制約 ━━━,,,
データ取得,方式,サーバーサイドフィルタリング,ページネーション対応（1ページ20件）
画像制約,ファイル制限,複数枚アップロード可能（最大10枚） ・ 各画像5MBまで,対応形式: jpg / jpeg / png / gif / webp
公開設定,可視性制御,作成者は公開・非公開切り替え可能,非公開キャラクターは作成者のみ閲覧可
権限チェック,アクセス制御,編集・削除は作成者のみ可能,CHAR_MANAGER以上の権限があれば他人のキャラクターも管理可能
ベクトル検索,AI機能,ローブックはpgvectorでベクトル埋め込み,チャット時に関連情報を自動検索
インポート機能,データ移行,他プラットフォームのキャラクターをJSON形式でインポート可能,
━━━ 3. 関連URL・遷移 ━━━,,,
URL一覧,/charlist,キャラクター一覧ページ（全公開キャラクター）,
,/characters/create,キャラクター作成ページ,
,/characters/edit/[id],キャラクター編集ページ,
,/characters/[characterId],キャラクター詳細ページ,
,/character-management,自分のキャラクター管理ページ,
遷移フロー,基本フロー,キャラクター一覧 → 詳細 → チャット開始 または キャラクター作成 → 編集 → 公開,
━━━ 4. 役割・権限 ━━━,,,
一般ユーザー,操作権限,閲覧・お気に入り・コメント可能 ・ 自分のキャラクターのみ作成・編集・削除可能,
CHAR_MANAGER,管理権限,全てのキャラクターを編集・削除可能 ・ キャラクター承認機能,
SUPER_ADMIN,最高権限,全てのキャラクター管理機能にアクセス可能,
━━━ 5. 主要機能一覧 ━━━,,,
キャラクター作成,入力項目,名前 ・ 説明 ・ カテゴリー ・ ハッシュタグ ・ システムプロンプト ・ 最初の台詞を設定,
画像アップロード,対応機能,複数枚の画像をアップロード ・ メイン画像とサブ画像を区別 ・ drag&dropまたはファイル選択,
公開/非公開設定,可視性制御,キャラクターを公開または非公開に設定 ・ 非公開は作成者のみ閲覧可能,
ローブック管理,知識ベース,キャラクターの背景知識・設定を登録 ・ ベクトル埋め込みで自動検索,
キャラクター編集,更新機能,既存キャラクターの全ての情報を編集可能 ・ 画像追加・削除も可能,
キャラクター削除,削除機能,キャラクターを完全削除 ・ 関連するチャット・コメントも削除 ・ 確認ダイアログ付き,
お気に入り機能,SNS機能,キャラクターをお気に入りに追加・削除 ・ お気に入り数を表示,
コメント機能,交流機能,キャラクターにコメントを投稿・編集・削除 ・ コメント一覧表示,
評価機能,レーティング,キャラクターに星評価（1〜5）を付与 ・ 平均評価を表示,
キャラクターインポート,データ移行,他プラットフォームのキャラクターデータ（JSON形式）をインポート,
カテゴリーフィルター,検索機能,カテゴリー別にフィルタリング（ファンタジー / 現代 / SF / 恋愛など）,
ハッシュタグ検索,検索機能,ハッシュタグで検索 ・ 複数タグでフィルタリング可能,
━━━ 6. 画面構成（UIブロック） ━━━,,,
キャラクターカード,表示要素,キャラクター画像 ・ 名前 ・ 説明（抜粋） ・ お気に入り数,クリックで詳細ページへ（CharacterCard.tsx）
キャラクター一覧グリッド,レイアウト,グリッドレイアウトで表示,レスポンシブ対応（PC: 4列 ・ タブレット: 3列 ・ モバイル: 2列）
キャラクター作成フォーム,入力欄,名前 ・ 説明 ・ カテゴリー ・ ハッシュタグ ・ システムプロンプト ・ 最初の台詞 ・ 画像アップロード欄,CharacterForm.tsx
画像アップロードエリア,機能,drag&drop対応 ・ プレビュー表示 ・ メイン画像選択 ・ 画像削除ボタン,
ローブックエディタ,入力欄,タイトル・内容を入力 ・ 複数のローブックエントリを追加可能 ・ 削除ボタン付き,
キャラクター詳細ヘッダー,表示要素,キャラクター画像 ・ 名前 ・ 説明 ・ 作成者 ・ お気に入りボタン ・ チャット開始ボタン,
キャラクター詳細タブ,タブ構成,概要 ・ 設定 ・ ローブック ・ コメントタブ,タブ切り替えで情報表示
コメントセクション,交流欄,コメント一覧 ・ 新規コメント投稿フォーム ・ 編集・削除ボタン（本人のみ）,
お気に入りボタン,UI要素,ハートアイコン ・ お気に入り追加・削除トグル ・ お気に入り数表示,
自分のキャラクター一覧,テーブル,テーブル形式で表示 ・ 編集・削除ボタン付き ・ 公開/非公開ステータス表示,CharacterRow.tsx
━━━ 7. 画面項目定義 ━━━,,,
【作成】キャラクター名,型: string,必須 ・ 1〜100文字,
【作成】説明,型: string,必須 ・ 10〜1000文字,
【作成】カテゴリー,型: string,必須 ・ 事前定義されたカテゴリーから選択,ファンタジー / 現代 / SF / 恋愛 / ホラーなど
【作成】ハッシュタグ,型: string[],任意 ・ 各タグ20文字以内 ・ 最大10個,カンマ区切り入力
【作成】システムプロンプト,型: string,必須 ・ 10〜2000文字,キャラクターのAI設定
【作成】最初の台詞,型: string,任意 ・ 1〜500文字,チャット開始時の挨拶
【作成】画像,型: file[],任意 ・ jpg/jpeg/png/gif/webp ・ 各5MB ・ 最大10枚,
【作成】公開設定,型: boolean,必須 ・ true（公開）/ false（非公開）,デフォルト: true
【ローブック】タイトル,型: string,必須 ・ 1〜200文字,
【ローブック】内容,型: string,必須 ・ 10〜5000文字,ベクトル埋め込み対象
【コメント】コメント内容,型: string,必須 ・ 1〜500文字,
【コメント】評価,型: number,任意 ・ 1〜5の整数,星評価
━━━ 8. フィルタ仕様 ━━━,,,
カテゴリーフィルター,適用方式,URLクエリパラメータ category で指定 ・ 複数選択可能（カンマ区切り）,
ハッシュタグフィルター,適用方式,URLクエリパラメータ tags で指定 ・ 部分一致検索,
公開/非公開フィルター,アクセス制御,非公開キャラクターは作成者またはCHAR_MANAGER以上のみ表示,
お気に入りフィルター,検索オプション,ユーザーのお気に入りキャラクターのみ表示するオプション,
並び替え,ソート順,作成日順（新しい順/古い順） ・ お気に入り数順 ・ 評価順,
━━━ 9. API I/F 仕様 ━━━,,,
GET /api/characters,パラメータ,{ category? ・ tags? ・ page ・ limit },レスポンス: { characters: [] ・ total ・ page ・ totalPages } ・ キャラクター一覧取得API
POST /api/characters,パラメータ,{ name ・ description ・ category ・ hashtags ・ systemPrompt ・ firstMessage ・ images ・ isPublic },レスポンス: { success ・ characterId } ・ キャラクター作成API
GET /api/characters?mode=my,パラメータ,{ page ・ limit },レスポンス: { characters: [] } ・ 自分のキャラクター一覧取得API
GET /api/characters/[id],パラメータ,パスなし,レスポンス: { character: { id ・ name ・ description ・ ... } } ・ キャラクター詳細取得API
PUT /api/characters/[id],パラメータ,{ name ・ description ・ category ・ hashtags ・ systemPrompt ・ firstMessage ・ images ・ isPublic },レスポンス: { success } ・ キャラクター更新API
DELETE /api/characters/[id],パラメータ,パスなし,レスポンス: { success ・ message } ・ キャラクター削除API
POST /api/characters/[id]/favorite,パラメータ,パスなし,レスポンス: { success ・ isFavorite } ・ お気に入り追加・削除API
GET /api/characters/[id]/comments,パラメータ,{ page ・ limit },レスポンス: { comments: [] ・ total } ・ コメント一覧取得API
POST /api/characters/[id]/comments,パラメータ,{ content ・ rating },レスポンス: { success ・ commentId } ・ コメント投稿API
PUT /api/characters/[id]/comments/[commentId],パラメータ,{ content ・ rating },レスポンス: { success } ・ コメント編集API
DELETE /api/characters/[id]/comments/[commentId],パラメータ,パスなし,レスポンス: { success } ・ コメント削除API
POST /api/characters/[id]/import,パラメータ,{ importData: JSON },レスポンス: { success ・ characterId } ・ キャラクターインポートAPI
GET /api/charlist,パラメータ,{ search? ・ category? ・ tags? ・ sort? ・ page ・ limit },レスポンス: { characters: [] ・ total } ・ 高度なフィルタリング対応API
━━━ 10. エラー・通知文言 ━━━,,,
作成エラー,表示タイミング: 名前未入力時,キャラクター名は必須です。,
作成エラー,表示タイミング: 説明が短すぎる時,説明は10文字以上入力してください。,
画像エラー,表示タイミング: 画像サイズオーバー時,画像サイズは5MB以下にしてください。,
画像エラー,表示タイミング: 画像枚数オーバー時,画像は最大10枚までアップロードできます。,
権限エラー,表示タイミング: 他人のキャラクター編集時,このキャラクターを編集する権限がありません。,
削除確認,表示タイミング: 削除ボタン押下時,このキャラクターを削除してもよろしいですか？ 関連するチャットとコメントも削除されます。,
成功メッセージ,表示タイミング: 作成成功時,キャラクターを作成しました。,
成功メッセージ,表示タイミング: 更新成功時,キャラクターを更新しました。,
成功メッセージ,表示タイミング: 削除成功時,キャラクターを削除しました。,
成功メッセージ,表示タイミング: お気に入り追加時,お気に入りに追加しました。,
成功メッセージ,表示タイミング: お気に入り削除時,お気に入りから削除しました。,
成功メッセージ,表示タイミング: コメント投稿成功時,コメントを投稿しました。,
━━━ 11. モーダル仕様 ━━━,,,
キャラクター削除確認,トリガー: 削除ボタン押下時,内容: 削除確認メッセージ ・ 関連データ削除の警告,ボタン: キャンセル ・ 削除
画像プレビュー,トリガー: 画像クリック時,内容: 画像を大きく表示 ・ 左右矢印で画像切り替え,ボタン: 閉じるボタン
ローブック追加,トリガー: ローブック追加ボタン押下時,内容: タイトル・内容入力フォーム,ボタン: キャンセル ・ 追加
コメント編集,トリガー: コメント編集ボタン押下時,内容: コメント内容編集フォーム,ボタン: キャンセル ・ 保存
インポート,トリガー: インポートボタン押下時,内容: JSON入力エリア ・ フォーマット説明,ボタン: キャンセル ・ インポート
━━━ 12. 認証・ガード ━━━,,,
認証チェック,制御方式,キャラクター作成・編集・削除はログイン必須 ・ 未ログインなら/loginへリダイレクト,
権限チェック,制御方式,編集・削除は作成者またはCHAR_MANAGER以上のみ可能 ・ 権限不足時はエラーメッセージ表示,
公開設定チェック,アクセス制御,非公開キャラクターは作成者またはCHAR_MANAGER以上のみ閲覧可能 ・ 他ユーザーは404表示,
━━━ 13. 非機能要件 ━━━,,,
パフォーマンス,最適化手法,キャラクター一覧はページネーション対応 ・ 画像はCDN配信 ・ ローブックのベクトル検索は高速化,
セキュリティ,セキュリティ対策,画像アップロードはウイルススキャン ・ XSS対策でコンテンツサニタイズ,
スケーラビリティ,拡張性,画像はAWS S3/Supabase Storageに保存 ・ データベースはインデックス最適化,
可用性,エラー処理,画像読み込みエラー時はプレースホルダー表示 ・ API失敗時はリトライ機能,
━━━ 14. テスト観点 ━━━,,,
キャラクター作成: 正常系,テストケース,全ての必須項目入力で作成成功,
キャラクター作成: 異常系,テストケース,必須項目未入力でバリデーションエラー表示,
画像アップロード: 正常系,テストケース,複数画像をアップロードしてプレビュー表示,
画像アップロード: 異常系（サイズ）,テストケース,5MBを超える画像でエラー表示,
画像アップロード: 異常系（枚数）,テストケース,10枚を超える画像でエラー表示,
キャラクター編集: 正常系,テストケース,作成者が自分のキャラクターを編集成功,
キャラクター編集: 異常系,テストケース,他人のキャラクター編集で権限エラー,
キャラクター削除: 正常系,テストケース,削除確認後にキャラクターと関連データ削除,
公開/非公開: 制御確認,テストケース,非公開キャラクターが他ユーザーに表示されないことを確認,
お気に入り: 機能確認,テストケース,お気に入り追加・削除のトグル動作確認,
コメント: 機能確認,テストケース,コメント投稿・編集・削除の動作確認,
ローブック: AI連携確認,テストケース,ローブック追加後にチャットで自動検索されることを確認,
フィルタリング: 検索確認,テストケース,カテゴリー・ハッシュタグでフィルタリング動作確認,
インポート: 機能確認,テストケース,JSON形式のキャラクターデータをインポート成功,
━━━ 15. 今後の拡張余地 ━━━,,,
AI画像生成,提案内容,キャラクター画像をAIで自動生成する機能,
キャラクターマーケットプレイス,提案内容,有料キャラクターの販売・購入機能,
コラボレーション,提案内容,複数ユーザーでキャラクターを共同編集する機能,
バージョン管理,提案内容,キャラクター編集履歴を保存し過去バージョンに戻す機能,
レコメンデーション,提案内容,ユーザーの好みに基づいてキャラクターを推薦,
高度な検索,提案内容,自然言語でキャラクターを検索する機能,
